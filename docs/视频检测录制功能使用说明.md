# 视频检测录制功能使用说明

## 功能概述

视频检测录制功能可以将检测过程实时标注到视频中，生成带有检测框和标签的处理后视频，类似实时摄像头的检测效果。

## 使用步骤

### 1. 打开检测页面
访问 http://localhost:8000

### 2. 选择视频检测模式
- 在页面顶部选择 "视频检测" 选项
- 此时会显示视频上传区域和录制选项

### 3. 启用录制功能
- 在文件上传区域下方，会出现录制选项
- **重要**: 勾选 "📹 录制检测过程（生成带标注的视频）" 复选框
- 如果不勾选此选项，系统只会检测视频的第一帧

### 4. 上传视频文件
- 点击 "选择文件" 或直接拖拽视频文件到上传区域
- 支持的格式：MP4、AVI、MOV

### 5. 开始检测
- 点击 "开始检测" 按钮
- 系统会显示处理进度

### 6. 查看结果
检测完成后，页面会显示：
- **检测统计**: 人体、发网、洗手、消毒的数量统计
- **处理后视频**: 带有检测框和标签的视频播放器
- **下载链接**: 可以下载处理后的视频文件
- **处理信息**: 总帧数、处理帧数、处理时间等详细信息

## 技术细节

### 处理方式
- 系统会逐帧分析视频（每5帧处理一次以优化性能）
- 在每一帧上绘制检测到的：
  - 人体检测框（蓝色）
  - 发网检测结果（绿色表示佩戴，红色表示未佩戴）
  - 洗手行为检测（黄色）
  - 消毒行为检测（紫色）

### 输出文件
- 处理后的视频保存在 `output/processed_videos/` 目录
- 文件名格式：`原文件名_processed_时间戳.mp4`
- 可通过下载链接获取文件

## 故障排除

### 问题1：没有生成录制视频
**原因**: 未勾选录制选项
**解决**: 确保在上传视频前勾选 "📹 录制检测过程" 复选框

### 问题2：录制选项不显示
**原因**: 未选择视频检测模式
**解决**: 在页面顶部选择 "视频检测" 而不是 "图片检测"

### 问题3：处理时间过长
**原因**: 视频文件过大或帧率过高
**解决**:
- 使用较短的视频文件进行测试
- 系统会自动跳帧处理以优化性能

### 问题4：下载链接无效
**原因**: 文件路径或权限问题
**解决**: 检查 `output/processed_videos/` 目录是否存在且有写入权限

## 测试建议

1. **使用短视频**: 建议使用10-30秒的视频进行初次测试
2. **包含人体**: 确保视频中有清晰的人体图像
3. **光线充足**: 良好的光线条件有助于提高检测准确性
4. **检查复选框**: 每次测试前确认已勾选录制选项

## API测试

如果需要通过API直接测试，可以使用以下curl命令：

```bash
# 录制模式
curl -X POST "http://localhost:8000/api/v1/detect/comprehensive" \
  -F "file=@your_video.mp4" \
  -F "record_process=true"

# 普通模式（仅检测第一帧）
curl -X POST "http://localhost:8000/api/v1/detect/comprehensive" \
  -F "file=@your_video.mp4" \
  -F "record_process=false"
```

## 日志监控

在服务器终端中，您可以看到以下关键日志：
- `录制模式: true/false` - 确认是否启用录制
- `开始处理视频` - 视频处理开始
- `处理进度: X%` - 处理进度更新
- `视频处理完成` - 处理完成信息

通过这些日志可以监控处理状态和排查问题。
